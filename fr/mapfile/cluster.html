<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>CLUSTER &mdash; MapServer 7.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '7.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="shortcut icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="À propos de ces documents" href="../about.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="MapServer 7.0.0 documentation" href="../index.html" />
    <link rel="up" title="Mapfile" href="index.html" />
    <link rel="next" title="COMPOSITE" href="composite.html" />
    <link rel="prev" title="CLASS" href="class.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../faq.html" title="FAQ">FAQ</a> |
      <a href="../download.html" title="Download">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        
          
            <a href="../../mapfile/cluster.html"><img src="../_static/flagicons/en.png" alt="en" title="en" border="0" /></a>
          
        
        
          
            <a href="../../ar/mapfile/cluster.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
          
        
        
          
            <a href="../../de/mapfile/cluster.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
          
        
        
          
            <a href="../../el/mapfile/cluster.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
          
        
        
          
            <a href="../../es/mapfile/cluster.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
          
        
        <img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" width="18px" height="13px"/>
        
          
            <a href="../../id/mapfile/cluster.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
          
        
        
          
            <a href="../../it/mapfile/cluster.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
          
        
        
          
            <a href="../../ja/mapfile/cluster.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
          
        
        
          
            <a href="../../nl_NL/mapfile/cluster.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
          
        
        
          
            <a href="../../pl/mapfile/cluster.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
          
        
        
          
            <a href="../../ru/mapfile/cluster.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
          
        
        
          
            <a href="../../sq/mapfile/cluster.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
          
        
        
          
            <a href="../../tr/mapfile/cluster.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
          
        
        
          
            <a href="../../uk/mapfile/cluster.html"><img src="../_static/flagicons/uk.png" alt="uk" title="uk" border="0" /></a>
          
        

    </td>
  </tr>
</table>


  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="cluster">
<span id="index-0"></span><span id="id1"></span><h1><a class="toc-backref" href="#table-of-contents">CLUSTER</a><a class="headerlink" href="#cluster" title="Lien permanent vers ce titre">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<span id="index-1"></span><p class="topic-title first">Table des matières</p>
<ul class="simple">
<li><a class="reference internal" href="#cluster" id="id2">CLUSTER</a><ul>
<li><a class="reference internal" href="#description" id="id3">Description</a></li>
<li><a class="reference internal" href="#supported-layer-types" id="id4">Types de couches supportés</a></li>
<li><a class="reference internal" href="#mapfile-parameters" id="id5">Paramètres du Mapfile</a></li>
<li><a class="reference internal" href="#supported-processing-options" id="id6">Options de traitements supportées</a></li>
<li><a class="reference internal" href="#mapfile-snippet" id="id7">Extrait de mapfile</a></li>
<li><a class="reference internal" href="#feature-attributes" id="id8">Attributs des entités</a></li>
<li><a class="reference internal" href="#php-mapscript-usage" id="id9">Usage avec PHP MapScript</a></li>
<li><a class="reference internal" href="#example-clustering-railway-stations" id="id10">Exemple: regroupement des gares</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#table-of-contents">Description</a><a class="headerlink" href="#description" title="Lien permanent vers ce titre">¶</a></h2>
<p>Depuis la version 6.0, Mapserver a la capcité de combiner plusieurs objets d&#8217;une couche ponctuelle en un seul (par aggrégation) à partir de leurs positions relatives. Seules les couches <em>POINT</em> sont supportées. Cette fonctionnalité a été ajoutée via la <a class="reference internal" href="../development/rfc/ms-rfc-69.html#rfc69"><span>MS RFC 69: Support for clustering of features in point layers</span></a>.</p>
</div>
<div class="section" id="supported-layer-types">
<h2><a class="toc-backref" href="#table-of-contents">Types de couches supportés</a><a class="headerlink" href="#supported-layer-types" title="Lien permanent vers ce titre">¶</a></h2>
<p>POINT</p>
</div>
<div class="section" id="mapfile-parameters">
<h2><a class="toc-backref" href="#table-of-contents">Paramètres du Mapfile</a><a class="headerlink" href="#mapfile-parameters" title="Lien permanent vers ce titre">¶</a></h2>
<dl class="docutils" id="index-2">
<dt>MAXDISTANCE [double]</dt>
<dd><p class="first last">Spécifier la distance de la région de recherche (rectangle ou ellipse) par la position en pixel</p>
</dd>
</dl>
<dl class="docutils" id="index-3">
<dt>REGION [string]</dt>
<dd><p class="first last">Définit la région de recherche autour d&#8217;un objet dans lequel les objets de voisins sont négociés. Cela peut être un &#8216;rectangle&#8217; ou une &#8216;ellipse&#8217;.</p>
</dd>
</dl>
<dl class="docutils" id="index-4">
<dt>BUFFER [double]</dt>
<dd><p class="first last">Définit une région tampon autour de l&#8217;étendue de la carte en pixels. La valeur par défaut est 0. Utiliser un tampon permet que les formes avoisinantes de la carte soit aussi prises en compte pendant la création du cluster.</p>
</dd>
</dl>
<dl class="docutils" id="index-5">
<dt><a class="reference internal" href="expressions.html#expressions"><span>GROUP</span></a> [string]</dt>
<dd>This expression evaluates to a string and only the features that
have the same group value are negotiated. This parameter can be
omitted. The evaluated group value is available in the
&#8216;Cluster_Group&#8217; feature attribute.</dd>
</dl>
<dl class="docutils" id="index-6">
<dt><a class="reference internal" href="expressions.html#expressions"><span>FILTER</span></a> [string]</dt>
<dd>We can define the FILTER expression filter some of the features
from the final output.  This expression evaluates to a boolean
value and if this value is false the corresponding shape is
filtered out.  This expression is evaluated after the the feature
negotiation is completed, therefore the &#8216;Cluster_FeatureCount&#8217;
parameter can also be used, which provides the option to filter
the shapes having too many or to few neighbors within the search
region.</dd>
</dl>
</div>
<div class="section" id="supported-processing-options">
<h2><a class="toc-backref" href="#table-of-contents">Options de traitements supportées</a><a class="headerlink" href="#supported-processing-options" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les options de traitement suivantes peuvent être utilisées avec les couches cluster:</p>
<dl class="docutils" id="index-7">
<dt>CLUSTER_GET_ALL_SHAPES</dt>
<dd><p class="first last">Retourne toutes les formes contenues par un cluster plutôt qu&#8217;une forme seule. Cette configuration affecte à la fois le le traitement du dessin et de l&#8217;interrogation.</p>
</dd>
</dl>
</div>
<div class="section" id="mapfile-snippet">
<h2><a class="toc-backref" href="#table-of-contents">Extrait de mapfile</a><a class="headerlink" href="#mapfile-snippet" title="Lien permanent vers ce titre">¶</a></h2>
<div class="highlight-mapfile"><div class="highlight"><pre><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&quot;my-cluster&quot;</span>
  <span class="k">TYPE</span> <span class="nb">POINT</span>
  <span class="p">...</span>
  <span class="k">CLUSTER</span>
     <span class="k">MAXDISTANCE</span> <span class="mi">20</span>  <span class="c"># in pixels</span>
     <span class="k">REGION</span> <span class="s">&quot;ellipse&quot;</span>  <span class="c"># can be rectangle or ellipse</span>
     <span class="k">GROUP</span> <span class="p">(</span><span class="k">expression</span><span class="p">)</span>  <span class="c"># an expression to create separate groups for each value</span>
     <span class="k">FILTER</span> <span class="p">(</span><span class="k">expression</span><span class="p">)</span> <span class="c"># a logical expression to specify the grouping condition</span>
  <span class="k">END</span>
  <span class="k">LABELITEM</span> <span class="s">&quot;Cluster_FeatureCount&quot;</span>
  <span class="k">CLASS</span>
    <span class="p">...</span>
    <span class="k">LABEL</span>
     <span class="p">...</span>
    <span class="k">END</span>
  <span class="k">END</span>
  <span class="p">...</span>
<span class="k">END</span>
</pre></div>
</div>
</div>
<div class="section" id="feature-attributes">
<span id="index-8"></span><h2><a class="toc-backref" href="#table-of-contents">Attributs des entités</a><a class="headerlink" href="#feature-attributes" title="Lien permanent vers ce titre">¶</a></h2>
<p>La couche regroupée elle-même fournies les attributs agrégés suivants :</p>
<span class="target" id="index-9"></span><ol class="arabic simple" id="index-10">
<li>Cluster_FeatureCount - count of the features in the clustered shape</li>
<li>Cluster_Group - The group value of the cluster (to which the group
expression is evaluated)</li>
</ol>
<p>Ces attributs (en plus de ceux forunis par la source de données originale) peuvent être utilisés pour configurer les étiquettes des objets et peuvent également être utilisés dans les expressions. L&#8217;option de traitement ITEMS peut être utilisée pour spécifier une sous-ensemble des attributs de la couche originale dans les opérations d&#8217;interrogation en fonction de la préférence utilisateur.</p>
<p id="index-11">We can use simple aggregate functions (Min, Max, Sum, Count) to
specify how the clustered attribute should be calculated from the
original attributes. The aggregate function should be specified as a
prefix separated by &#8216;:&#8217; in the attribute definition, like:
[Max:itemname]. If we don&#8217;t specify aggregate functions for the source
layer attributes, then the actual value of the cluster attribute will
be non-deterministic if the cluster contains multiple shapes with
different values. The Count aggregate function in fact provides the
same value as Cluster_FeatureCount.</p>
</div>
<div class="section" id="php-mapscript-usage">
<h2><a class="toc-backref" href="#table-of-contents">Usage avec PHP MapScript</a><a class="headerlink" href="#php-mapscript-usage" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference internal" href="../mapscript/php/phpmapscript.html#phpclusterobj"><span>L&#8217;objet CLUSTER</span></a> est exposé via PHP MapScript. Un exemple suit:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">$map = ms_newMapobj(&quot;/var/www/vhosts/mysite/httpdocs/test.map&quot;);</span>
<span class="x">$layer1=$map-&gt;getLayerByName(&quot;test1&quot;);</span>
<span class="x">$layer1-&gt;cluster;</span>
</pre></div>
</div>
</div>
<div class="section" id="example-clustering-railway-stations">
<h2><a class="toc-backref" href="#table-of-contents">Exemple: regroupement des gares</a><a class="headerlink" href="#example-clustering-railway-stations" title="Lien permanent vers ce titre">¶</a></h2>
<p>L&#8217;exemple suivant utilise une source ponctuelle, dans ce cas en format KML, pour afficher les regroupements de gares. Deux classes sont utilisées: une pour styler et étiqueter le regroupement, l&#8217;autre pour styler et étiqueter la gare simple.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Comme nous ne pouvons pas utiliser 2 &#8220;labelitems&#8221;, pour la classe gare simple, nous utilisons le paramètre <em>TEXT</em> pour étiqueter la gare.</p>
</div>
<div class="section" id="mapfile-layer">
<h3>Couche de Mapfile<a class="headerlink" href="#mapfile-layer" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-mapfile"><div class="highlight"><pre><span class="c">####################</span>
<span class="c"># Lightrail Stations</span>
<span class="c">####################</span>
<span class="k">SYMBOL</span>
  <span class="k">NAME</span> <span class="s">&quot;lightrail&quot;</span>
  <span class="k">TYPE</span> <span class="nb">PIXMAP</span>
  <span class="k">IMAGE</span> <span class="s">&quot;../etc/lightrail.png&quot;</span>
<span class="k">END</span>
<span class="k">LAYER</span>
    <span class="k">NAME</span> <span class="s">&quot;lightrail&quot;</span>
    <span class="k">GROUP</span> <span class="s">&quot;default&quot;</span>
    <span class="k">STATUS</span> <span class="nb">DEFAULT</span>
    <span class="k">TYPE</span> <span class="nb">POINT</span>
    <span class="k">CONNECTIONTYPE</span> <span class="nb">OGR</span>
    <span class="k">CONNECTION</span> <span class="s">&quot;lightrail-stations.kml&quot;</span>
    <span class="k">DATA</span> <span class="s">&quot;lightrail-stations&quot;</span>
    <span class="k">LABELITEM</span> <span class="s">&quot;Cluster_FeatureCount&quot;</span>
    <span class="k">CLASSITEM</span> <span class="s">&quot;Cluster_FeatureCount&quot;</span>
    <span class="c">###########################</span>
    <span class="c"># Define the cluster object</span>
    <span class="c">###########################</span>
    <span class="k">CLUSTER</span>
      <span class="k">MAXDISTANCE</span> <span class="mi">50</span>
      <span class="k">REGION</span> <span class="s">&quot;ellipse&quot;</span>
    <span class="k">END</span>
    <span class="c">################################</span>
    <span class="c"># Class1: For the cluster symbol</span>
    <span class="c">################################</span>
    <span class="k">CLASS</span>
      <span class="k">NAME</span> <span class="s">&quot;Clustered Lightrail Stations&quot;</span>
      <span class="k">EXPRESSION</span> <span class="p">(</span><span class="s">&quot;[Cluster_FeatureCount]&quot;</span> <span class="o">!=</span> <span class="s">&quot;1&quot;</span><span class="p">)</span>
      <span class="k">STYLE</span>
        <span class="k">SIZE</span> <span class="mi">30</span>
        <span class="k">SYMBOL</span> <span class="s">&quot;citycircle&quot;</span>
        <span class="k">COLOR</span> <span class="mi">255</span> <span class="mi">0</span> <span class="mi">0</span>
      <span class="k">END</span>
      <span class="k">LABEL</span>
        <span class="k">FONT</span> <span class="err">scb</span>
        <span class="k">TYPE</span> <span class="nb">TRUETYPE</span>
        <span class="k">SIZE</span> <span class="mi">8</span>
        <span class="k">COLOR</span> <span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span>
        <span class="k">ALIGN</span> <span class="nb">CENTER</span>
        <span class="k">PRIORITY</span> <span class="mi">10</span>
        <span class="k">BUFFER</span> <span class="mi">1</span>
        <span class="k">PARTIALS</span> <span class="nb">TRUE</span>
        <span class="k">POSITION</span> <span class="nb">cc</span>
      <span class="k">END</span>
    <span class="k">END</span>
    <span class="c">################################</span>
    <span class="c"># Class2: For the single station</span>
    <span class="c">################################</span>
    <span class="k">CLASS</span>
      <span class="k">NAME</span> <span class="s">&quot;Lightrail Stations&quot;</span>
      <span class="k">EXPRESSION</span> <span class="s">&quot;1&quot;</span>
      <span class="k">STYLE</span>
        <span class="k">SIZE</span> <span class="mi">30</span>
        <span class="k">SYMBOL</span> <span class="s">&quot;lightrail&quot;</span>
      <span class="k">END</span>
      <span class="k">TEXT</span> <span class="s">&quot;[Name]&quot;</span>
      <span class="k">LABEL</span>
        <span class="k">FONT</span> <span class="err">scb</span>
        <span class="k">TYPE</span> <span class="nb">TRUETYPE</span>
        <span class="k">SIZE</span> <span class="mi">8</span>
        <span class="k">COLOR</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
        <span class="k">OUTLINECOLOR</span> <span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span>
        <span class="k">ALIGN</span> <span class="nb">CENTER</span>
        <span class="k">PRIORITY</span> <span class="mi">9</span>
        <span class="k">BUFFER</span> <span class="mi">1</span>
        <span class="k">PARTIALS</span> <span class="nb">FALSE</span>
        <span class="k">POSITION</span> <span class="nb">ur</span>
      <span class="k">END</span>
    <span class="k">END</span>
    <span class="c"># the following is used for a query</span>
    <span class="k">TOLERANCE</span> <span class="mi">50</span>
    <span class="k">UNITS</span> <span class="nb">PIXELS</span>
    <span class="k">HEADER</span> <span class="s">&quot;../htdocs/templates/cluster_header.html&quot;</span>
    <span class="k">FOOTER</span> <span class="s">&quot;../htdocs/templates/cluster_footer.html&quot;</span>
    <span class="k">TEMPLATE</span> <span class="s">&quot;../htdocs/templates/cluster_query.html&quot;</span>
<span class="k">END</span>
</pre></div>
</div>
</div>
<div class="section" id="map-image">
<h3>Image de carte<a class="headerlink" href="#map-image" title="Lien permanent vers ce titre">¶</a></h3>
<img alt="../_images/cluster.png" src="../_images/cluster.png" />
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">CLUSTER</a><ul>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#supported-layer-types">Types de couches supportés</a></li>
<li><a class="reference internal" href="#mapfile-parameters">Paramètres du Mapfile</a></li>
<li><a class="reference internal" href="#supported-processing-options">Options de traitements supportées</a></li>
<li><a class="reference internal" href="#mapfile-snippet">Extrait de mapfile</a></li>
<li><a class="reference internal" href="#feature-attributes">Attributs des entités</a></li>
<li><a class="reference internal" href="#php-mapscript-usage">Usage avec PHP MapScript</a></li>
<li><a class="reference internal" href="#example-clustering-railway-stations">Exemple: regroupement des gares</a><ul>
<li><a class="reference internal" href="#mapfile-layer">Couche de Mapfile</a></li>
<li><a class="reference internal" href="#map-image">Image de carte</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Open Source Geospatial Foundation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>