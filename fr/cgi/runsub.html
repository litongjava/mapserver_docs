<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Substitution à la volée &mdash; MapServer 7.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '7.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="shortcut icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="À propos de ces documents" href="../about.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="MapServer 7.0.0 documentation" href="../index.html" />
    <link rel="up" title="CGI" href="index.html" />
    <link rel="next" title="Un simple script de wrapper CGI" href="wrapper.html" />
    <link rel="prev" title="Contrôles CGI pour MapServer" href="controls.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../faq.html" title="FAQ">FAQ</a> |
      <a href="../download.html" title="Download">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        
          
            <a href="../../cgi/runsub.html"><img src="../_static/flagicons/en.png" alt="en" title="en" border="0" /></a>
          
        
        
          
            <a href="../../ar/cgi/runsub.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
          
        
        
          
            <a href="../../de/cgi/runsub.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
          
        
        
          
            <a href="../../el/cgi/runsub.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
          
        
        
          
            <a href="../../es/cgi/runsub.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
          
        
        <img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" width="18px" height="13px"/>
        
          
            <a href="../../id/cgi/runsub.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
          
        
        
          
            <a href="../../it/cgi/runsub.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
          
        
        
          
            <a href="../../ja/cgi/runsub.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
          
        
        
          
            <a href="../../nl_NL/cgi/runsub.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
          
        
        
          
            <a href="../../pl/cgi/runsub.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
          
        
        
          
            <a href="../../ru/cgi/runsub.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
          
        
        
          
            <a href="../../sq/cgi/runsub.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
          
        
        
          
            <a href="../../tr/cgi/runsub.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
          
        
        
          
            <a href="../../uk/cgi/runsub.html"><img src="../_static/flagicons/uk.png" alt="uk" title="uk" border="0" /></a>
          
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="wrapper.html" title="Un simple script de wrapper CGI"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="controls.html" title="Contrôles CGI pour MapServer"
             accesskey="P">précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >Documentation de MapServer 7.0.0</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">CGI</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="run-time-substitution">
<span id="runsub"></span><span id="index-0"></span><h1><a class="toc-backref" href="#table-of-contents">Substitution à la volée</a><a class="headerlink" href="#run-time-substitution" title="Lien permanent vers ce titre">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Steve Lime</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">steve.lime at DNR.STATE.MN.US</td>
</tr>
<tr class="field-odd field"><th class="field-name">Revision:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field-even field"><th class="field-name">Last Updated:</th><td class="field-body">$Date$</td>
</tr>
</tbody>
</table>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table des matières</p>
<ul class="simple">
<li><a class="reference internal" href="#run-time-substitution" id="id1">Substitution à la volée</a><ul>
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#basic-example" id="id3">Exemple basique</a></li>
<li><a class="reference internal" href="#parameters-supported" id="id4">Paramètres gérés</a></li>
<li><a class="reference internal" href="#default-values-if-not-provided-in-the-url" id="id5">Valeurs par défaut si non fournies dans l&#8217;URL</a></li>
<li><a class="reference internal" href="#validation" id="id6">VALIDATION</a></li>
<li><a class="reference internal" href="#magic-values" id="id7">Valeurs magiques</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#table-of-contents">Introduction</a><a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>La substitution à la volée pour le MapServer CGI a été mise en place depuis la version 4.0 et son utilisation a continué à se développer. En bref, elle vous permet de modifier des parties d&#8217;un mapfile basée sur les données transmises via une requête CGI. Cette fonctionnalité est uniquement disponible via l&#8217;application standard CGI.</p>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Cette fonctionnalité est seulement disponible via l&#8217;application CGI <a class="reference internal" href="mapserv.html#mapserv"><span>mapserv</span></a>. A l&#8217;aide de MapScript, il est facile de le faire par soi-même comme le développeur a un contrôle total sur la manière dont l&#8217;entrée est gérée.</p>
</div>
<div class="section" id="case-sensitivity">
<h3>Sensible à la casse<a class="headerlink" href="#case-sensitivity" title="Lien permanent vers ce titre">¶</a></h3>
<p>Depuis la version 6.4, les noms des paramètres CGI sont insensibles à la casse. Les valeurs des paramètres CGI sont eux sensibles à la casse.</p>
</div>
</div>
<div class="section" id="basic-example">
<h2><a class="toc-backref" href="#table-of-contents">Exemple basique</a><a class="headerlink" href="#basic-example" title="Lien permanent vers ce titre">¶</a></h2>
<p>Disons que vous souhaitez que l&#8217;utilisateur définisse dynamiquement une partie d&#8217;une expression pour qu&#8217;ils puissent mettre en évidence une certaine classe d&#8217;occupation des sols, et vous avez un formulaire (appelé ctype) qui leur permettent de choisir entre : forêts, eau, zones humides et développées. Vous pouvez ensuite</p>
<p>Une requête doit ressembler à ceci (en supposant que &#8220;marsh&#8221; est une classe valide pour land cover)</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>http://...mapserv?map=....&amp;ctype=marsh
</pre></div>
</div>
<p>Vous pouvez alors configurer une couche de cette manière :</p>
<div class="highlight-mapfile"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
    <span class="k">NAME</span> <span class="s">&#39;covertypes&#39;</span>
    <span class="p">...</span>
    <span class="k">VALIDATION</span>
        <span class="s">&quot;ctype&quot;</span> <span class="s">&quot;[a-z]+&quot;</span>
    <span class="k">END</span>
    <span class="k">CLASSITEM</span> <span class="s">&#39;type&#39;</span>
    <span class="k">CLASS</span> <span class="c"># highlighted presentation</span>
        <span class="k">EXPRESSION</span> <span class="s">&#39;</span><span class="si">%c</span><span class="s">type%&#39;</span>
        <span class="p">...</span>
    <span class="k">END</span>
    <span class="k">CLASS</span> <span class="c"># default presentation</span>
        <span class="p">...</span>
    <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>Quand une requête est traitée la valeur pour ctype est remplacé par la chaîne %Ctype% et le mapfile est traitée comme d&#8217;habitude. Si aucun ctype n&#8217;est passé dans EXPRESSION celle-ci ne sera jamais vraie par conséquent cela ne posera pas de problème sauf une petite baisse de performance. Souvent, vous devrez définir une classe par défaut pour dessiner les géométries qui ne correspondent pas, mais ce n&#8217;est pas obligatoire.</p>
</div>
<div class="section" id="parameters-supported">
<span id="index-1"></span><h2><a class="toc-backref" href="#table-of-contents">Paramètres gérés</a><a class="headerlink" href="#parameters-supported" title="Lien permanent vers ce titre">¶</a></h2>
<p>Tous les paramètres du mapfile ne sont pas gérés pour la substitution à la volée et une attention a été portée pour essayer de gérer ceux qui font le plus de sens. N&#8217;oubliez pas que vous pouvez aussi configurer à la volée en utilisant la syntaxe du type map_object_property détaillée dans <a class="reference internal" href="controls.html#cgi-mapfile-change-parameters"><span>Modifier les paramètres du fichier map à l&#8217;aide d&#8217;un formulaire ou d&#8217;une URL</span></a>. Voici une liste des propriétés dont la substitution à la volée est permise :</p>
<ul>
<li><p class="first">CLASS: EXPRESSION</p>
</li>
<li><p class="first">CLASS: TEXT</p>
</li>
<li><p class="first">LAYER: CONNECTION</p>
</li>
<li><p class="first">LAYER: DATA</p>
</li>
<li><p class="first">LAYER: FILTER</p>
</li>
<li><p class="first">LAYER: TILEINDEX</p>
</li>
<li><p class="first">LAYER: METADATA</p>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 7.0.</span></p>
</div>
</li>
<li><p class="first">LAYER: PROCESSING</p>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 7.0.</span></p>
</div>
</li>
<li><p class="first">OUTPUTFORMAT: FORMATOPTION: FILENAME (doit avoir un pattern au niveau de la <cite>VALIDATION</cite> dans <cite>MAP</cite>)</p>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 6.2.</span></p>
</div>
</li>
<li><p class="first">OUTPUTFORMAT: tous les FORMATOPTIONs</p>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 7.0.</span></p>
</div>
</li>
<li><p class="first">MAP-&gt;WEB: METADATA (les valeurs seulement, pas les clés)</p>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 7.0.</span></p>
</div>
</li>
</ul>
<div class="section" id="filters">
<span id="index-2"></span><h3>FILTER<a class="headerlink" href="#filters" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous pouvez utiliser des substitutions à la volée pour modifier des valeurs dans un FILTER. Par exemple, votre objet FILTER peut être écrit comme ceci:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>FILTER (multimedia=&#39;%multimedia%&#39; and seats &gt;= &#39;%nseats%&#39; and Sound= &#39;%sound%&#39;)
</pre></div>
</div>
<p>Puis (en supposant que vous utilisez l&#8217;interface CGI), vous pourrez passer des variables nommées multimedia, nseats et le sound avec des valeurs définies par l&#8217;utilisateur dans un formulaire HTML.</p>
<p>Vous devez également définir des expressions de validation sur ces variables pour prévenir contre la soumission involontaire de requête SQL à PostGIS (depuis la version 6.0, la validation est obligatoire). A l&#8217;intérieur de la couche, vous ferez comme suivant :</p>
<div class="highlight-mapfile"><div class="highlight"><pre><span></span><span class="k">VALIDATION</span>
    <span class="s">&#39;multimedia&#39;</span> <span class="s">&#39;^yes|no$&#39;</span>
    <span class="s">&#39;sound&#39;</span> <span class="s">&#39;^yes|no$&#39;</span>
    <span class="s">&#39;nseats&#39;</span> <span class="s">&#39;^[0-9]{1,2}$&#39;</span>
<span class="k">END</span>
</pre></div>
</div>
<p>Les chaînes de validation sont des expressions régulières qui sont appliquées sur les valeurs de la variable appropriée avant d&#8217;être ajoutée au filtre. Les deux premiers limitent la valeur de multimedia et de sounds à oui ou non. La troisième limite la valeur pour nseats à un nombre entier à 2 chiffres.</p>
</div>
</div>
<div class="section" id="default-values-if-not-provided-in-the-url">
<span id="index-3"></span><h2><a class="toc-backref" href="#table-of-contents">Valeurs par défaut si non fournies dans l&#8217;URL</a><a class="headerlink" href="#default-values-if-not-provided-in-the-url" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le mécanisme de substitution à la volée créera toujours des mapfiles incorrect au niveau de la syntaxe et presque toujours au niveau sématique si le paramètre de substitution n&#8217;a pas été fournie dans l&#8217;url.</p>
<p>Depuis la version 5.6, vous pouvez fournir une valeur par défaut pour n&#8217;importe quel paramètre de substitution qui sera appliqué si le paramètre n&#8217;était pas trouvé dans l’URL. Vous pouvez réaliser cela en fournissant des entrées spéciales dans les blocs de validation de <a class="reference internal" href="../mapfile/class.html#class"><span>CLASS</span></a>, <a class="reference internal" href="../mapfile/layer.html#layer"><span>LAYER</span></a> ou <a class="reference internal" href="../mapfile/web.html#web"><span>WEB</span></a> :</p>
<div class="highlight-mapfile"><div class="highlight"><pre><span></span><span class="k">VALIDATION</span>
    <span class="s">&#39;default_sound&#39;</span> <span class="s">&#39;yes&#39;</span>
    <span class="s">&#39;default_nseats&#39;</span> <span class="s">&#39;5&#39;</span>
    <span class="s">&#39;default_multimedia&#39;</span> <span class="s">&#39;yes&#39;</span>
<span class="k">END</span>
</pre></div>
</div>
<p>Dans cet exemple, le mapfile sera créé comme si l&#8217;url contenait &#8220;&amp;sound=yes&amp;nseats=5&amp;multimedia=yes&#8221;.</p>
<p>Si des clés par défaut identiques apparaissent dans plus d&#8217;un bloc de validation, alors les clés dans les blocs plus spécialisés surchargeront ceux qui sont dans les blocs plus généralistes c&#8217;est à dire que <cite>CLASS</cite> aura priorité sur <cite>LAYER</cite> qui aura lui-même priorité sur <cite>WEB</cite>. La même fonctionnalité est disponible en utilisant les blocs <cite>METADATA</cite> à la place de <cite>VALIDATION</cite> mais c&#8217;est déprécié avec MapServer 5.4.0. Ce comportement est également accessible dans l&#8217;utilitaire shp2img, vous permettant de tester les mapfiles avec substitution à la volée sans l&#8217;aide d&#8217;un serveur web.</p>
<span class="target" id="index-4"></span></div>
<div class="section" id="validation">
<span id="index-5"></span><h2><a class="toc-backref" href="#table-of-contents">VALIDATION</a><a class="headerlink" href="#validation" title="Lien permanent vers ce titre">¶</a></h2>
<p>Comme la substitution à la volée affecte potentiellement des zones sensibles de votre mapfile, comme les colonnes et les noms de base de données, il est obligatoire d&#8217;utiliser une validation par pattern (depuis la version 6.0)</p>
<p>La validation par pattern utilise les expressions régulières, qui sont des chaînes qui décrivent comment comparer des chaînes de caractères avec des patterns. La même fonctionnalité d&#8217;expressions régulières de votre système est susceptible de varier, mais vous pouvez trouver un grand nombre d&#8217;informations génrales en effectuant une recherche Google avec &#8220;tutoriel expressions régulières&#8221;.</p>
<p>Depuis MapServer 5.4.0, le mécanisme à préférer est le bloc de <cite>VALIDATION</cite> dans la définition <cite>LAYER</cite>. Cela ne diffère que légèrement du vieux mécanisme avec <cite>METADATA</cite>.  Les blocs de <cite>VALIDATION</cite> peuvent être utilisés avec <a class="reference internal" href="../mapfile/class.html#class"><span>CLASS</span></a>, <a class="reference internal" href="../mapfile/layer.html#layer"><span>LAYER</span></a> et <a class="reference internal" href="../mapfile/web.html#web"><span>WEB</span></a>.</p>
<div class="highlight-mapfile"><div class="highlight"><pre><span></span><span class="k">VALIDATION</span>
  <span class="c"># %firstname% substitutions can only have letters and hyphens</span>
  <span class="s">&#39;firstname&#39;</span>     <span class="s">&#39;^[a-zA-Z\-]+$&#39;</span>

  <span class="c"># %parcelid% must be numeric and between 5 and 8 characters</span>
  <span class="s">&#39;parcelid&#39;</span>      <span class="s">&#39;^[0-9]{5,8)$&#39;</span>

  <span class="c"># %taxid% must be two capital letters and six digits</span>
  <span class="s">&#39;taxid&#39;</span>         <span class="s">&#39;^[A-Z]{2}[0-9]{6}$&#39;</span>
<span class="k">END</span>
</pre></div>
</div>
<p>Si des clés identiques apparaissent dans plus d&#8217;un bloc de validation, alors les clés dans les blocs plus spécialisés surchargeront ceux qui sont dans les blocs plus généralistes, c&#8217;est à dire que <cite>CLASS</cite> aura priorité sur <cite>LAYER</cite> qui aura lui-même priorité sur <cite>WEB</cite>.</p>
</div>
<div class="section" id="magic-values">
<h2><a class="toc-backref" href="#table-of-contents">Valeurs magiques</a><a class="headerlink" href="#magic-values" title="Lien permanent vers ce titre">¶</a></h2>
<p>Certaines substitutions à la volée ont des avertissements spéciaux.</p>
<dl class="docutils">
<dt>ID</dt>
<dd><p class="first last">En plus de la définition de n&#8217;importe quel <cite>METADATA</cite> ou <cite>VALIDATION</cite>, le paramètre &#8216;id&#8217; sera sujet à une vérification spéciale. Il doit être alphanumérique et ne peut pas dépasser en longueur 63 caractères.</p>
</dd>
</dl>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Substitution à la volée</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#case-sensitivity">Sensible à la casse</a></li>
</ul>
</li>
<li><a class="reference internal" href="#basic-example">Exemple basique</a></li>
<li><a class="reference internal" href="#parameters-supported">Paramètres gérés</a><ul>
<li><a class="reference internal" href="#filters">FILTER</a></li>
</ul>
</li>
<li><a class="reference internal" href="#default-values-if-not-provided-in-the-url">Valeurs par défaut si non fournies dans l&#8217;URL</a></li>
<li><a class="reference internal" href="#validation">VALIDATION</a></li>
<li><a class="reference internal" href="#magic-values">Valeurs magiques</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Open Source Geospatial Foundation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.4</a>
      
    </div>

    

    
  </body>
</html>